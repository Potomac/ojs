#!/bin/sh

echo "[OJS CLI Install] First time running this container, preparing..."
echo "127.0.0.1 $SERVERNAME" >> /etc/hosts

echo "enter install"

# replace @ character by %40
email=`echo ${OJS_ADMIN_EMAIL} | sed "s/@/%40/"`

echo "[OJS CLI Install] Calling the install using pre-defined variables..."    
curl "http://${SERVERNAME}/index/install/install" --data "installing=0&adminUsername=${OJS_ADMIN_NAME}&adminPassword=${OJS_ADMIN_PASSWORD}&adminPassword2=${OJS_ADMIN_PASSWORD}&adminEmail=$email&locale=${OJS_PRIMARY_LOCALE}&additionalLocales%5B%5D=${OJS_SECONDARY_LOCALE}&clientCharset=utf-8&connectionCharset=utf8&databaseCharset=utf8&filesDir=%2Fvar%2Fwww%2Ffiles&databaseDriver=mysqli&databaseHost=${OJS_DB_HOST}&databaseUsername=${OJS_DB_USER}&databasePassword=${OJS_DB_PASSWORD}&databaseName=${OJS_DB_NAME}&oaiRepositoryId=${SERVERNAME}&enableBeacon=0" --compressed

echo "[OJS CLI Install] DONE!"
